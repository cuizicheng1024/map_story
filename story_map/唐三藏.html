<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç„å¥˜çš„äººç”Ÿè¶³è¿¹åœ°å›¾</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" onerror="if(!this.dataset.f){this.dataset.f='1';this.href='https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';}else if(this.dataset.f==='1'){this.dataset.f='2';this.href='https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css';}" />
<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js" onerror="if(!this.dataset.f){this.dataset.f='1';this.src='https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';}else if(this.dataset.f==='1'){this.dataset.f='2';this.src='https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js';}"></script>
<script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js" onerror="if(!this.dataset.f){this.dataset.f='1';this.src='https://unpkg.com/react@18/umd/react.production.min.js';}else if(this.dataset.f==='1'){this.dataset.f='2';this.src='https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js';}"></script>
<script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js" onerror="if(!this.dataset.f){this.dataset.f='1';this.src='https://unpkg.com/react-dom@18/umd/react-dom.production.min.js';}else if(this.dataset.f==='1'){this.dataset.f='2';this.src='https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js';}"></script>
<script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.24.7/babel.min.js" onerror="if(!this.dataset.f){this.dataset.f='1';this.src='https://unpkg.com/@babel/standalone@7.24.7/babel.min.js';}else if(this.dataset.f==='1'){this.dataset.f='2';this.src='https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.24.7/babel.min.js';}"></script>
<style>
body {
  font-family: 'Noto Serif SC', serif;
  background-color: #fdf6e3;
  color: #2c3e50;
}
#map {
  height: 620px;
  width: 100%;
  border-radius: 8px;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  z-index: 1;
}
.custom-scrollbar::-webkit-scrollbar {
  width: 6px;
}
.custom-scrollbar::-webkit-scrollbar-track {
  background: #f1f1f1;
}
.custom-scrollbar::-webkit-scrollbar-thumb {
  background: #c0392b;
  border-radius: 10px;
}
.glass-panel {
  background: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(4px);
  border: 1px solid rgba(200, 180, 150, 0.3);
}
.desc-clamp {
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.age-marker {
  background: transparent;
  border: none;
}
.age-badge {
  background: rgba(255, 255, 255, 0.65);
  color: #7c2d12;
  padding: 2px 6px;
  border-radius: 10px;
  font-size: 10px;
  border: 1px solid rgba(200, 180, 150, 0.5);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
  white-space: nowrap;
}
</style>
</head>
<body class="p-4 md:p-8">
<div id="root"></div>
<script type="text/babel" data-presets="env,react">
const { useState, useEffect, useRef, useMemo } = React;
const data = {"person": {"name": "ç„å¥˜", "title": "ä¸‰è—æ³•å¸ˆ", "description": "ç„å¥˜æ˜¯å”ä»£è‘—åé«˜åƒ§ã€‚ä»–ç”Ÿäºå„’å­¦ä¸–å®¶ï¼Œå¹¼å¹´å‡ºå®¶ï¼Œå› æ·±æ„Ÿä¸­åœŸä½›ç»è¯‘æœ¬ä¸å…¨ã€ä¹‰ç†åˆ†æ­§ï¼Œç«‹å¿—è¥¿è¡Œæ±‚å–çœŸç»ã€‚è´è§‚ä¸‰å¹´ï¼ˆ629å¹´ï¼Œä¸€è¯´è´è§‚å…ƒå¹´ï¼‰ï¼Œä»–è¿ç¦å‡ºå…³ï¼Œå†ç»è¥¿åŸŸè¯¸å›½ï¼Œå…‹æœé‡é‡é™©é˜»ï¼Œæœ€ç»ˆæŠµè¾¾å°åº¦ä½›æ•™ä¸­å¿ƒé‚£çƒ‚é™€å¯ºã€‚ä»–åœ¨å°ç•™å­¦åä½™å¹´ï¼Œéè®¿åå¸ˆï¼Œç²¾é€šç»è®ºï¼Œå¹¶åœ¨æ›²å¥³åŸæ— é®è¾©è®ºå¤§ä¼šä¸Šç«‹è®ºä¸è´¥ï¼Œèµ¢å¾—æé«˜å£°èª‰ã€‚è´è§‚åä¹å¹´ï¼ˆ645å¹´ï¼‰ï¼Œä»–æºå¤§é‡ä½›ç»ä½›åƒå›åˆ°é•¿å®‰ï¼Œå—åˆ°å”å¤ªå®—æ¥è§ã€‚æ­¤åè¿‘äºŒåå¹´ï¼Œä»–å…¨å¿ƒæŠ•å…¥è¯‘ç»äº‹ä¸šï¼Œç³»ç»Ÿç¿»è¯‘äº†å¤§é‡ç‘œä¼½è¡Œæ´¾ç»å…¸ï¼Œå¹¶åˆ›ç«‹äº†æ³•ç›¸å”¯è¯†å®—ã€‚å…¶å£è¿°çš„ã€Šå¤§å”è¥¿åŸŸè®°ã€‹æ˜¯ç ”ç©¶å¤ä»£ä¸­äºšå’Œå°åº¦å†å²åœ°ç†çš„çè´µæ–‡çŒ®ã€‚éºŸå¾·å…ƒå¹´ï¼ˆ664å¹´ï¼‰ï¼Œç„å¥˜äºç‰åå®«åœ†å¯‚ã€‚", "quote": "æ— ç›´æ¥å¯¹åº”è¯—ä½œï¼Œä½†å…¶è¯‘ç»äº‹ä¸šå…³è”é•¿å®‰ã€‚ã€Šå¤§å”è¥¿åŸŸè®°Â·åºã€‹ï¼š`â€œæ¨è¡¨å±±å·ï¼Œè€ƒé‡‡å¢ƒå£¤ï¼Œè¯¦å›½ä¿—ä¹‹åˆšæŸ”ï¼Œç³»æ°´åœŸä¹‹é£æ°”ã€‚â€`", "dynasty": "å”æœ", "birthplace": "æ´›å·ç¼‘æ°å¿", "avatar": "", "birth": {"date": "602å¹´", "location": "æ´›å·ç¼‘æ°å¿", "lat": 36.994419, "lng": 115.279897}, "death": {"date": "664å¹´", "location": "ç‰åå®«", "lat": 31.483724, "lng": 118.569183}, "lifespan": "62å²ï¼ˆæˆ–64å²ï¼‰"}, "locations": [{"name": "æ´›å·ç¼‘æ°å¿", "ancientName": "æ´›å·ç¼‘æ°å¿", "modernName": "æ²³å—çœæ´›é˜³å¸‚åƒå¸ˆåŒºç¼‘æ°é•‡é™ˆæ²³æ‘", "lat": 34.621589, "lng": 112.794379, "type": "birth", "event": "å‡ºç”Ÿäºä¹¦é¦™é—¨ç¬¬ï¼Œå¹¼å¹´èªæ…§ï¼Œå—å…¶äºŒå“¥é•¿æ·æ³•å¸ˆå½±å“ï¼Œåˆæ­¥æ¥è§¦ä½›å­¦ã€‚", "time": "å…¬å…ƒ602å¹´ï¼ˆä¸€è¯´600å¹´ï¼‰", "duration": "ç«¥å¹´æ—¶æœŸ", "significance": "äººç”Ÿèµ·ç‚¹ï¼Œå¥ å®šå…¶å„’å­¦åŸºç¡€ä¸å‘ä½›åˆå¿ƒã€‚", "works": [], "quoteLines": []}, {"name": "é•¿å®‰", "ancientName": "å”éƒ½é•¿å®‰", "modernName": "é™•è¥¿çœè¥¿å®‰å¸‚", "lat": 34.285821, "lng": 108.9479051, "type": "normal", "event": "æ—©å¹´æ¸¸å­¦äºé•¿å®‰ã€æˆéƒ½ç­‰åœ°ï¼Œç©¶é€šè¯¸éƒ¨ï¼Œå‘ç°ä½›ç†å¼‚è¯´çº·çº­ï¼Œå†³æ„è¥¿è¡Œã€‚è´è§‚åä¹å¹´ï¼ˆ645å¹´ï¼‰å–ç»å½’æ¥ï¼Œå—åˆ°ç››å¤§æ¬¢è¿ï¼Œåäºå¼˜ç¦å¯ºã€å¤§æ…ˆæ©å¯ºã€ç‰åå®«ç­‰åœ°ä¸»æŒè¯‘åœºï¼Œç¿»è¯‘ä½›ç»ã€‚", "time": "çº¦618å¹´â€”629å¹´ï¼›645å¹´â€”664å¹´", "duration": "å‰æœŸå­¦ä¹ ä¸å‡†å¤‡è¥¿è¡Œï¼›åæœŸè¯‘ç»ä¸å¼˜æ³•ç›´è‡³åœ†å¯‚", "significance": "è¥¿è¡Œçš„èµ·ç‚¹ä¸ç»ˆç‚¹ï¼Œæ¯•ç”Ÿè¯‘ç»äº‹ä¸šçš„ä¸­å¿ƒï¼Œå…¶å½±å“åŠ›ç”±æ­¤è¾å°„å…¨å›½ã€‚", "works": [], "quoteLines": ["æ— ç›´æ¥å¯¹åº”è¯—ä½œï¼Œä½†å…¶è¯‘ç»äº‹ä¸šå…³è”é•¿å®‰ã€‚ã€Šå¤§å”è¥¿åŸŸè®°Â·åºã€‹ï¼š`â€œæ¨è¡¨å±±å·ï¼Œè€ƒé‡‡å¢ƒå£¤ï¼Œè¯¦å›½ä¿—ä¹‹åˆšæŸ”ï¼Œç³»æ°´åœŸä¹‹é£æ°”ã€‚â€`"]}, {"name": "ç“œå·/ç‰é—¨å…³", "ancientName": "ç“œå·ï¼›ç‰é—¨å…³ï¼ˆå”ä»£æ•…å€åœ¨ä»Šç“œå·å¿å¢ƒå†…ï¼‰", "modernName": "ç”˜è‚ƒçœé…’æ³‰å¸‚ç“œå·å¿", "lat": 40.520457, "lng": 95.782255, "type": "normal", "event": "åœ¨æ­¤å¤„å¾—åˆ°èƒ¡äººçŸ³æ§ƒé™€ç›¸åŠ©ï¼Œå¤œæ¸¡è‘«èŠ¦æ²³ï¼Œå·è¶Šç‰é—¨å…³ï¼Œå¹¶åœ¨æ­¤åç‹¬è‡ªç©¿è¶Šè«è´ºå»¶ç¢›ï¼ˆæˆˆå£æ²™æ¼ ï¼‰ï¼Œç»å†â€œå››å¤œäº”æ—¥æ— ä¸€æ»´æ²¾å–‰â€çš„ç”Ÿæ­»è€ƒéªŒã€‚", "time": "å…¬å…ƒ629å¹´", "duration": "çŸ­æš‚åœç•™", "significance": "è¥¿è¡Œè·¯ä¸Šç¬¬ä¸€ä¸ªé‡å¤§é™©å…³ï¼Œæ ‡å¿—ç€æ­£å¼ç¦»å¼€å¤§å”å›½å¢ƒï¼Œè¿›å…¥è¥¿åŸŸé™©é€”ã€‚", "works": [], "quoteLines": []}, {"name": "é«˜æ˜Œå›½", "ancientName": "é«˜æ˜Œå›½ï¼ˆéƒ½åŸä½äºä»Šæ–°ç–†åé²ç•ªå¸‚é«˜æ˜Œæ•…åŸï¼‰", "modernName": "é«˜æ˜Œå›½ï¼ˆéƒ½åŸä½äºä»Šæ–°ç–†åé²ç•ªå¸‚é«˜æ˜Œæ•…åŸï¼‰", "lat": 34.8683979, "lng": 114.5890975, "type": "normal", "event": "å—åˆ°é«˜æ˜Œç‹éº¹æ–‡æ³°çš„æåº¦ç¤¼é‡ä¸å¼ºåŠ›æŒ½ç•™ï¼Œç„å¥˜ä»¥ç»é£Ÿæ˜å¿—ï¼Œæœ€ç»ˆæ„ŸåŠ¨å›½ç‹ã€‚ä¸¤äººç»“ä¸ºå…„å¼Ÿï¼Œéº¹æ–‡æ³°æä¾›å¤§é‡ç‰©èµ„ã€éšä»ä¸é€šå…³æ–‡ä¹¦ï¼ŒåŠ©å…¶è¥¿è¡Œã€‚", "time": "å…¬å…ƒ629å¹´", "duration": "çº¦ä¸€ä¸ªæœˆ", "significance": "è¥¿è¡Œæ—…ç¨‹çš„å…³é”®è½¬æŠ˜ç‚¹ï¼Œä»æ­¤è·å¾—äº†é‡è¦çš„ç‰©è´¨ä¸æ”¿æ²»æ”¯æŒï¼Œä½¿åç»­è¡Œç¨‹æ›´ä¸ºé¡ºåˆ©ã€‚", "works": [], "quoteLines": []}, {"name": "é£’ç§£å»ºå›½", "ancientName": "é£’ç§£å»ºå›½ï¼ˆå³åº·å›½ï¼Œéƒ½åŸåœ¨ä»Šä¹Œå…¹åˆ«å…‹æ–¯å¦æ’’é©¬å°”ç½•ï¼‰", "modernName": "é£’ç§£å»ºå›½ï¼ˆå³åº·å›½ï¼Œéƒ½åŸåœ¨ä»Šä¹Œå…¹åˆ«å…‹æ–¯å¦æ’’é©¬å°”ç½•ï¼‰", "lat": 82.07329, "lng": 44.88364, "type": "normal", "event": "åˆåˆ°æ—¶ï¼Œå› è¯¥å›½ä¿¡å¥‰æ‹œç«æ•™ï¼Œå¯¹ä½›æ•™ä¸æ•¬ã€‚ç„å¥˜ä¸ºå…¶ç‹è®²è§£ä½›æ³•ï¼Œå¹¶ç¤ºç°ç¥é€šï¼ŒæˆåŠŸè¯´æœå›½ç‹ï¼Œä½¿ä½›æ•™åœ¨å½“åœ°å¾—åˆ°å°Šé‡ã€‚", "time": "çº¦å…¬å…ƒ630å¹´", "duration": "çŸ­æš‚åœç•™", "significance": "å±•ç°äº†ç„å¥˜çš„è¾©æ‰ä¸å¼˜æ³•èƒ½åŠ›ï¼Œåœ¨ä¸­äºšåœ°åŒºä¼ æ’­äº†ä½›æ•™å½±å“ã€‚", "works": [], "quoteLines": []}, {"name": "æ›²å¥³åŸ", "ancientName": "æ›²å¥³åŸï¼ˆç¾¯è‹¥é é˜‡å›½éƒ½åŸï¼Œä»Šå°åº¦åŒ—æ–¹é‚¦å¡ç‘™æ°ï¼‰", "modernName": "æ›²å¥³åŸï¼ˆç¾¯è‹¥é é˜‡å›½éƒ½åŸï¼Œä»Šå°åº¦åŒ—æ–¹é‚¦å¡ç‘™æ°ï¼‰", "lat": 30.274663, "lng": 120.129281, "type": "normal", "event": "æˆ’æ—¥ç‹ä¸ºç„å¥˜ä¸¾åŠè§„æ¨¡å®å¤§çš„æ— é®è¾©è®ºå¤§ä¼šï¼Œäº”å°åº¦åå…«å›½ç‹ã€å¤§å°ä¹˜åƒ§åŠå©†ç½—é—¨ç­‰æ•°åƒäººå‚åŠ ã€‚ç„å¥˜å°†è®ºç‚¹æ‚¬æŒ‚äºä¼šåœºé—¨å¤–ï¼Œåå…«æ—¥å†…æ— äººèƒ½é©³å€’ï¼Œè¢«å°Šä¸ºâ€œå¤§ä¹˜å¤©â€å’Œâ€œè§£è„±å¤©â€ã€‚", "time": "å…¬å…ƒ642å¹´", "duration": "å¤§ä¼šæœŸé—´", "significance": "å­¦æœ¯ç”Ÿæ¶¯çš„å·…å³°æ—¶åˆ»ï¼Œç¡®ç«‹äº†å…¶åœ¨å°åº¦ä½›æ•™ç•Œçš„è‡³é«˜åœ°ä½ï¼Œåéœ‡äº”å°åº¦ã€‚", "works": [], "quoteLines": []}, {"name": "äºé˜—å›½", "ancientName": "äºé˜—å›½", "modernName": "æ–°ç–†å’Œç”°åœ°åŒº", "lat": 79.921646, "lng": 37.114406, "type": "normal", "event": "å½’å›½é€”ä¸­åœ¨æ­¤åœç•™ï¼Œä¸€è¾¹è®²ç»ï¼Œä¸€è¾¹æ´¾äººå‘å”å¤ªå®—ä¸Šè¡¨ï¼Œé™ˆè¿°è‡ªå·±å½“å¹´ç§è¶Šå›½å¢ƒè¥¿è¡ŒåŠå–ç»å½’æ¥çš„æƒ…å†µï¼Œç­‰å€™æœå»·çš„èµ¦ä»¤ä¸æ—¨æ„ã€‚", "time": "å…¬å…ƒ644å¹´", "duration": "çº¦ä¸ƒã€å…«ä¸ªæœˆ", "significance": "å›å½’å¤§å”ç–†åŸŸçš„ç¬¬ä¸€ç«™ï¼Œåœ¨æ­¤ä¸ä¸­å¤®æ”¿åºœé‡æ–°å–å¾—è”ç³»ï¼Œä¸ºé¡ºåˆ©å›å›½é“ºå¹³é“è·¯ã€‚", "works": [], "quoteLines": []}, {"name": "æ´›é˜³", "ancientName": "ä¸œéƒ½æ´›é˜³", "modernName": "æ²³å—çœæ´›é˜³å¸‚", "lat": 34.619702, "lng": 112.453895, "type": "normal", "event": "å”å¤ªå®—å½“æ—¶åœ¨æ´›é˜³å‡†å¤‡å¾è¾½ï¼Œç‰¹å‘½ç„å¥˜é€Ÿæ¥ç›¸è§ã€‚å›è‡£ä¼šé¢ï¼Œå¤ªå®—å¯¹å…¶ç»å†æä¸ºèµèµï¼ŒåŠå…¶è¿˜ä¿—è¾…æ”¿ï¼Œè¢«ç„å¥˜å©‰æ‹’ï¼Œåªæ±‚ä¸“å¿ƒè¯‘ç»ã€‚", "time": "å…¬å…ƒ645å¹´", "duration": "çŸ­æš‚è°’è§", "significance": "å–å¾—æœ€é«˜ç»Ÿæ²»è€…çš„å®˜æ–¹è®¤å¯ä¸æ”¯æŒï¼Œä¸ºå…¶åç»­å¤§è§„æ¨¡çš„è¯‘ç»äº‹ä¸šæä¾›äº†æ”¿æ²»ä¿éšœã€‚", "works": [], "quoteLines": []}, {"name": "å¤§æ…ˆæ©å¯º", "ancientName": "é•¿å®‰æ™‹æ˜ŒåŠ", "modernName": "é™•è¥¿çœè¥¿å®‰å¸‚å—", "lat": 34.343207, "lng": 108.939645, "type": "normal", "event": "å¤ªå­ææ²»ï¼ˆåä¸ºå”é«˜å®—ï¼‰ä¸ºè¿½å¿µæ¯äº²æ–‡å¾·çš‡åè€Œå»ºæ­¤å¯ºï¼Œç„å¥˜è¢«è¯·ä¸ºé¦–ä»»ä¸Šåº§ä¸»æŒï¼Œå¹¶åœ¨æ­¤ç£é€ å¤§é›å¡”ç”¨ä»¥ä¿å­˜ä»å°åº¦å¸¦å›çš„ç»åƒèˆåˆ©ã€‚æ­¤å¤„æ˜¯å…¶åæœŸé‡è¦çš„è¯‘ç»ä¸­å¿ƒä¹‹ä¸€ã€‚", "time": "å…¬å…ƒ652å¹´åŠä¹‹å", "duration": "é•¿æœŸå±…ä½è¯‘ç»", "significance": "æˆä¸ºé•¿å®‰çš„ä½›æ•™æ–‡åŒ–åœ°æ ‡ï¼Œç„å¥˜åœ¨æ­¤åŸ¹å…»äº†ä¼—å¤šå¼Ÿå­ï¼Œæ³•ç›¸å®—ç”±æ­¤å…´ç››ã€‚", "works": [], "quoteLines": []}, {"name": "ç‰åå®«", "ancientName": "åŠå·ç‰åå®«", "modernName": "é™•è¥¿çœé“œå·å¸‚å°å°åŒºç‰åé•‡", "lat": 35.304879, "lng": 108.925681, "type": "death", "event": "æ™šå¹´ä¸ºé¿æš‘åŠæ¸…é™è¯‘ç»ï¼Œç§»å±…ç‰åå®«ã€‚åœ¨æ­¤ç¿»è¯‘å…¶æ¯•ç”Ÿæœ€é‡è¦çš„å·¨è‘—ã€Šå¤§èˆ¬è‹¥ç»ã€‹å…­ç™¾å·ã€‚è¯‘æ¯•åè‡ªè§‰ä½“åŠ›è¡°ç«­ï¼ŒäºéºŸå¾·å…ƒå¹´äºŒæœˆäº”æ—¥å¤œåŠåœ†å¯‚ã€‚", "time": "å…¬å…ƒ664å¹´", "duration": "ç”Ÿå‘½æœ€åå‡ å¹´åœ¨æ­¤è¯‘ç»å¹¶åœ†å¯‚", "significance": "äººç”Ÿç»ˆç‚¹ï¼Œä¹Ÿæ˜¯å…¶è¯‘ç»äº‹ä¸šçš„ç»ˆç»“åœ°ã€‚", "works": ["å¤§èˆ¬è‹¥ç»"], "quoteLines": ["åœ†å¯‚å‰ï¼Œå¼Ÿå­é—®å…¶ç”Ÿå¤„ï¼Œç­”ï¼š`â€œå¾—ç”Ÿå¼¥å‹’å†…é™¢ã€‚â€` åˆäº‘ï¼š`â€œå¾çœ¼å‰æœ‰ç™½è²èŠ±ï¼Œå¤§äºç›˜ï¼Œé²œå‡€å¯çˆ±ã€‚â€` å…¶åè¯‘åœºå·¥ä½œå…³è”ã€Šå¤§èˆ¬è‹¥ç»ã€‹ã€‚"]}], "mapStyle": {"pathColor": "#1e40af", "markers": {"normal": {"iconUrl": "https://a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-default.png", "color": "#3498db"}, "birth": {"iconUrl": "https://a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-green.png", "color": "#2ecc71"}, "death": {"iconUrl": "https://a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-red.png", "color": "#e74c3c"}}}};
const locations = data.locations || [];
const mapStyle = data.mapStyle || {};
const markerStyles = mapStyle.markers || {};
const defaultMarkerStyles = {
  normal: {
    iconUrl: 'https://a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-default.png',
    color: '#3498db'
  },
  birth: {
    iconUrl: 'https://a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-green.png',
    color: '#2ecc71'
  },
  death: {
    iconUrl: 'https://a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-red.png',
    color: '#e74c3c'
  }
};
const calculateDistance = (lat1, lon1, lat2, lon2) => {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLon / 2) * Math.sin(dLon / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
};
const extractYear = (text) => {
  if (!text) return null;
  const match = String(text).match(/(\d{3,4})\s*å¹´/);
  return match ? parseInt(match[1], 10) : null;
};
const App = () => {
  const [selectedLoc, setSelectedLoc] = useState(locations[0] || null);
  const [activeIndex, setActiveIndex] = useState(0);
  const [showFullDesc, setShowFullDesc] = useState(false);
  const [splitPct, setSplitPct] = useState(30);
  const mapRef = useRef(null);
  const splitRef = useRef(null);
  const draggingRef = useRef(false);
  const totalEvents = locations.length;
  const avatarUrl = data.person?.avatar || '';
  const description = data.person?.description || '';
  const quoteText = data.person?.quote || data.person?.title || '';
  const descSegments = useMemo(() => {
    if (!description) return [];
    const parts = description.split(/([ã€‚ï¼ï¼Ÿ])/);
    const segs = [];
    for (let i = 0; i < parts.length; i += 2) {
      const seg = `${parts[i] || ''}${parts[i + 1] || ''}`.trim();
      if (seg) segs.push(seg);
    }
    return segs;
  }, [description]);
  const isLongDesc = useMemo(() => description.length > 120 || descSegments.length > 3, [description, descSegments]);
  const stats = useMemo(() => {
    let totalDist = 0;
    for (let i = 0; i < locations.length - 1; i++) {
      totalDist += calculateDistance(
        locations[i].lat, locations[i].lng,
        locations[i+1].lat, locations[i+1].lng
      );
    }
    const regions = new Set(locations.map(l => (l.modernName || l.name || '').split(/[\s/]/)[0]).filter(Boolean));
    const years = parseInt((data.person?.lifespan || '').replace(/\D/g, ''), 10) || 0;
    return {
      distance: Math.round(totalDist),
      regions: regions.size,
      events: locations.length,
      years: years
    };
  }, []);
  const birthDate = data.person?.birth?.date || '';
  const deathDate = data.person?.death?.date || '';
  const lifeDates = birthDate || deathDate
    ? `${birthDate}${birthDate && deathDate ? '-' : ''}${deathDate}`
    : (data.person?.lifespan || '');
  const birthYear = useMemo(() => extractYear(birthDate), [birthDate]);
  const getAgeText = (loc) => {
    const year = extractYear(loc.time || '');
    if (!birthYear || !year) return '';
    const age = year - birthYear + 1;
    if (!Number.isFinite(age) || age <= 0 || age > 150) return '';
    return `${age}å²`;
  };
  const renderDescription = () => {
    if (!description) return null;
    return (
      <div className="mb-4">
        <div className={`text-gray-600 leading-relaxed ${showFullDesc ? '' : 'desc-clamp'}`}>
          {descSegments.map((seg, idx) => (
            <span key={idx} className="block">{seg}</span>
          ))}
        </div>
        {isLongDesc ? (
          <button
            onClick={() => setShowFullDesc(!showFullDesc)}
            className="text-xs text-[#c0392b] mt-1"
          >
            {showFullDesc ? 'æ”¶èµ·' : 'å±•å¼€'}
          </button>
        ) : null}
      </div>
    );
  };
  const changeEvent = (nextIndex) => {
    if (nextIndex < 0 || nextIndex >= totalEvents || nextIndex === activeIndex) return;
    const nextLoc = locations[nextIndex] || null;
    setActiveIndex(nextIndex);
    setSelectedLoc(nextLoc);
    if (mapRef.current && nextLoc) {
      mapRef.current.setView([nextLoc.lat, nextLoc.lng], 7);
    }
  };
  useEffect(() => {
    if (!mapRef.current) {
      const first = locations[0] || { lat: 35, lng: 105 };
      const map = L.map('map', { zoomControl: false }).setView([first.lat, first.lng], locations.length ? 4 : 4);
      L.control.zoom({ position: 'topright' }).addTo(map);
      const tileSources = [
        {
          url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
          options: { attribution: '&copy; OpenStreetMap contributors' }
        },
        {
          url: 'https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png',
          options: { attribution: '&copy; OpenStreetMap contributors' }
        },
        {
          url: 'https://{s}.tile.openstreetmap.de/{z}/{x}/{y}.png',
          options: { attribution: '&copy; OpenStreetMap contributors' }
        },
        {
          url: 'https://webrd{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}',
          options: { subdomains: ['0', '1', '2', '3'], attribution: '&copy; é«˜å¾·åœ°å›¾' }
        },
        {
          url: 'https://webst{s}.is.autonavi.com/appmaptile?style=7&x={x}&y={y}&z={z}',
          options: { subdomains: ['0', '1', '2', '3'], attribution: '&copy; é«˜å¾·åœ°å›¾' }
        }
      ];
      const addTileLayer = (mapInstance) => {
        let idx = 0;
        let errorCount = 0;
        let layer = L.tileLayer(tileSources[idx].url, tileSources[idx].options);
        const handleError = () => {
          errorCount += 1;
          if (errorCount >= 8) {
            idx += 1;
            if (idx >= tileSources.length) {
              return;
            }
            mapInstance.removeLayer(layer);
            layer = L.tileLayer(tileSources[idx].url, tileSources[idx].options);
            layer.addTo(mapInstance);
            errorCount = 0;
            layer.on('tileerror', handleError);
          }
        };
        layer.on('tileerror', handleError);
        layer.addTo(mapInstance);
      };
      addTileLayer(map);
      const resolveMarkerStyle = (type) => {
        if (markerStyles[type]) return markerStyles[type];
        if (markerStyles.normal) return markerStyles.normal;
        return defaultMarkerStyles[type] || defaultMarkerStyles.normal;
      };
      const markerIcon = (type) => {
        const iconUrl = resolveMarkerStyle(type).iconUrl || defaultMarkerStyles.normal.iconUrl;
        return L.icon({
          iconUrl,
          iconSize: [25, 34],
          iconAnchor: [12, 34],
          popupAnchor: [0, -30]
        });
      };
      const pathCoords = locations.map(l => [l.lat, l.lng]);
      for (let i = 0; i < pathCoords.length - 1; i++) {
        const opacity = 0.25 + (i / pathCoords.length) * 0.6;
        L.polyline([pathCoords[i], pathCoords[i+1]], {
          color: mapStyle.pathColor || '#1e40af',
          weight: 3,
          opacity: opacity
        }).addTo(map);
      }
      locations.forEach((loc, idx) => {
        const style = resolveMarkerStyle(loc.type || 'normal');
        L.circleMarker([loc.lat, loc.lng], {
          radius: 10,
          color: style.color || defaultMarkerStyles.normal.color,
          fillColor: style.color || defaultMarkerStyles.normal.color,
          fillOpacity: 0.35,
          weight: 2
        }).addTo(map);
        const marker = L.marker([loc.lat, loc.lng], { icon: markerIcon(loc.type || 'normal') }).addTo(map);
        marker.on('click', () => {
          setSelectedLoc(loc);
          setActiveIndex(idx);
          map.setView([loc.lat, loc.lng], 7);
        });
        const ageText = getAgeText(loc);
        if (ageText) {
          const ageIcon = L.divIcon({
            className: 'age-marker',
            html: `<div class="age-badge">${ageText}</div>`,
            iconSize: [44, 20],
            iconAnchor: [22, 30]
          });
          L.marker([loc.lat, loc.lng], { icon: ageIcon, interactive: false }).addTo(map);
        }
      });
      if (pathCoords.length > 1) {
        const bounds = L.latLngBounds(pathCoords);
        map.fitBounds(bounds, { padding: [48, 48], maxZoom: 6 });
      } else if (pathCoords.length === 1) {
        map.setView(pathCoords[0], 6);
      }
      mapRef.current = map;
    }
  }, []);
  useEffect(() => {
    const onMove = (e) => {
      if (!draggingRef.current || !splitRef.current) return;
      const rect = splitRef.current.getBoundingClientRect();
      const next = ((e.clientX - rect.left) / rect.width) * 100;
      if (!Number.isFinite(next)) return;
      const clamped = Math.min(60, Math.max(20, next));
      setSplitPct(clamped);
    };
    const onUp = () => {
      draggingRef.current = false;
    };
    window.addEventListener('mousemove', onMove);
    window.addEventListener('mouseup', onUp);
    return () => {
      window.removeEventListener('mousemove', onMove);
      window.removeEventListener('mouseup', onUp);
    };
  }, []);
  const handleLocClick = (loc, idx) => {
    setSelectedLoc(loc);
    if (typeof idx === 'number') {
      setActiveIndex(idx);
    }
    if (mapRef.current) {
      mapRef.current.setView([loc.lat, loc.lng], 7);
    }
  };
  return (
    <div className="max-w-screen-2xl mx-auto space-y-6">
      <header className="glass-panel p-6 rounded-xl shadow-sm border-l-8 border-[#c0392b] flex flex-col md:flex-row gap-6 items-center">
        <div className="w-32 h-32 bg-[#e5e7eb] rounded-full flex items-center justify-center border-4 border-white shadow-inner overflow-hidden">
          {avatarUrl ? (
            <img src={avatarUrl} alt={data.person?.name || ''} className="w-full h-full object-cover" />
          ) : (
            <span className="text-gray-600 text-2xl">{data.person?.name || ''}</span>
          )}
        </div>
        <div className="flex-1 text-center md:text-left">
          <h1 className="text-4xl font-bold">{data.person.name}</h1>
          {quoteText ? (
            <p className="text-xs text-gray-500 mt-1 mb-2">{quoteText}</p>
          ) : null}
          {renderDescription()}
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
            <div>
              <p className="text-gray-400 text-sm">æœä»£</p>
              <p className="font-bold">{data.person?.dynasty || ''}</p>
            </div>
            <div>
              <p className="text-gray-400 text-sm">ç±è´¯</p>
              <p className="font-bold">{data.person?.birthplace || ''}</p>
            </div>
            <div>
              <p className="text-gray-400 text-sm">ç”Ÿå’</p>
              <p className="font-bold">{lifeDates}</p>
            </div>
            <div>
              <p className="text-gray-400 text-sm">äº«å¹´</p>
              <p className="font-bold">{data.person?.lifespan || ''}</p>
            </div>
          </div>
        </div>
      </header>
      <div className="space-y-6">
        <div ref={splitRef} className="flex flex-col lg:flex-row gap-6 items-stretch">
          <div
            className="glass-panel rounded-xl overflow-hidden flex flex-col h-[620px]"
            style={{ flexBasis: `${splitPct}%`, flexGrow: 0 }}
          >
            <div className="p-4 bg-[#c0392b] text-white font-bold flex items-center justify-between">
              <span>è¶³è¿¹æ—¶é—´è½´</span>
              <div className="flex items-center gap-2 text-xs">
                <button
                  onClick={() => changeEvent(activeIndex - 1)}
                  disabled={activeIndex === 0}
                  className="px-2 py-1 rounded bg-white/20 disabled:opacity-40"
                >ä¸Šä¸€äº‹ä»¶</button>
                <span className="opacity-80">{totalEvents ? activeIndex + 1 : 0} / {totalEvents}</span>
                <button
                  onClick={() => changeEvent(activeIndex + 1)}
                  disabled={activeIndex + 1 >= totalEvents}
                  className="px-2 py-1 rounded bg-white/20 disabled:opacity-40"
                >ä¸‹ä¸€äº‹ä»¶</button>
              </div>
            </div>
            <div className="flex-1 overflow-y-auto custom-scrollbar p-3 space-y-3">
              {locations.length ? (
                locations.map((loc, idx) => (
                  <div
                    key={idx}
                    onClick={() => handleLocClick(loc, idx)}
                    className={`p-3 rounded-lg cursor-pointer transition-all border-l-4 ${
                      idx === activeIndex
                        ? 'bg-white shadow-md border-[#c0392b]'
                        : 'bg-white/70 border-transparent hover:bg-white'
                    }`}
                  >
                    <div className="flex justify-between items-start mb-2">
                      <span className="font-bold text-sm">{loc.name}</span>
                      <span className="text-[10px] px-1.5 py-0.5 rounded bg-gray-100 text-gray-500">
                        {loc.time || 'æœªçŸ¥'}
                      </span>
                    </div>
                    <div className="space-y-1 text-[11px] text-gray-500 mb-2">
                      <div className="flex justify-between">
                        <span>å…¬å…ƒçºªå¹´</span>
                        <span className="text-gray-700">{loc.time || 'æœªçŸ¥'}</span>
                      </div>
                      <div className="flex justify-between">
                        <span>åœç•™æ—¶é—´</span>
                        <span className="text-gray-700">{loc.duration || 'æœªçŸ¥'}</span>
                      </div>
                    </div>
                    <p className="text-xs text-gray-500">{loc.event}</p>
                  </div>
                ))
              ) : (
                <div className="text-xs text-gray-400">æš‚æ— äº‹ä»¶</div>
              )}
            </div>
          </div>
          <div
            className="hidden lg:block w-2 rounded bg-[#c8b496]/50 hover:bg-[#c8b496] cursor-col-resize"
            onMouseDown={(e) => {
              e.preventDefault();
              draggingRef.current = true;
            }}
          ></div>
          <div className="relative flex-1">
            <div id="map"></div>
            {selectedLoc && (
              <div className="absolute top-4 left-4 z-[1000] w-72 glass-panel p-4 rounded-xl shadow-xl border-t-4 border-[#c0392b]">
                <button
                  onClick={() => setSelectedLoc(null)}
                  className="absolute top-2 right-2 text-gray-400 hover:text-gray-600"
                >âœ•</button>
                <h3 className="text-xl font-bold text-[#c0392b] mb-1">{selectedLoc.name}</h3>
                <p className="text-xs text-gray-400 mb-3">{selectedLoc.ancientName} â†’ {selectedLoc.modernName}</p>
                <div className="space-y-3 text-sm">
                  <div>
                    <p className="text-gray-400 text-[10px] uppercase font-bold">å…¬å…ƒçºªå¹´</p>
                    <p>{selectedLoc.time || 'æœªçŸ¥'}</p>
                  </div>
                  <div>
                    <p className="text-gray-400 text-[10px] uppercase font-bold">åœç•™æ—¶é—´</p>
                    <p>{selectedLoc.duration || 'æœªçŸ¥'}</p>
                  </div>
                  <div>
                    <p className="text-gray-400 text-[10px] uppercase font-bold">äº‹è¿¹æè¿°</p>
                    <p className="leading-relaxed">{selectedLoc.event}</p>
                  </div>
                  <div className="bg-[#fdf6e3] p-2 rounded border border-dashed border-[#c8b496]">
                    <p className="text-[#c0392b] text-[10px] uppercase font-bold">å†å²æ„ä¹‰</p>
                    <p className="italic text-xs">{selectedLoc.significance}</p>
                  </div>
                  {selectedLoc.quoteLines?.length ? (
                    <div>
                      <p className="text-gray-400 text-[10px] uppercase font-bold">åç¯‡åå¥</p>
                      <ul className="space-y-1">
                        {selectedLoc.quoteLines.map((q, idx) => (
                          <li key={idx} className="text-xs text-gray-700">{q}</li>
                        ))}
                      </ul>
                    </div>
                  ) : selectedLoc.works?.length ? (
                    <div>
                      <p className="text-gray-400 text-[10px] uppercase font-bold">åç¯‡åå¥</p>
                      <ul className="list-disc pl-4 space-y-1">
                        {selectedLoc.works.map((w, idx) => (
                          <li key={idx} className="text-xs text-gray-700">ã€Š{w}ã€‹</li>
                        ))}
                      </ul>
                    </div>
                  ) : null}
                </div>
              </div>
            )}
          </div>
        </div>
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div className="glass-panel p-4 rounded-xl text-center">
            <p className="text-2xl mb-1">ğŸ—ºï¸</p>
            <p className="text-xl font-bold">{stats.distance} <span className="text-xs font-normal">km</span></p>
            <p className="text-[10px] text-gray-400 uppercase">æ€»è¡Œç¨‹ä¼°ç®—</p>
          </div>
          <div className="glass-panel p-4 rounded-xl text-center">
            <p className="text-2xl mb-1">â±ï¸</p>
            <p className="text-xl font-bold">{stats.years} <span className="text-xs font-normal">å¹´</span></p>
            <p className="text-[10px] text-gray-400 uppercase">ç”Ÿå‘½è·¨åº¦</p>
          </div>
          <div className="glass-panel p-4 rounded-xl text-center">
            <p className="text-2xl mb-1">ğŸ“</p>
            <p className="text-xl font-bold">{stats.regions} <span className="text-xs font-normal">ä¸ª</span></p>
            <p className="text-[10px] text-gray-400 uppercase">è¦†ç›–åœ°åŒº</p>
          </div>
          <div className="glass-panel p-4 rounded-xl text-center">
            <p className="text-2xl mb-1">ğŸŒŸ</p>
            <p className="text-xl font-bold">{stats.events} <span className="text-xs font-normal">ä»¶</span></p>
            <p className="text-[10px] text-gray-400 uppercase">é‡è¦äº‹è¿¹</p>
          </div>
        </div>
      </div>
      <footer className="text-center text-gray-400 text-[10px] py-8 border-t border-gray-200">
        <p>build by cuicheng</p>
      </footer>
    </div>
  );
};
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>